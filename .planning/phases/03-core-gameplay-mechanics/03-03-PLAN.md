---
phase: 03-core-gameplay-mechanics
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified: [ecs/systems/ui_system.py, ecs/systems/render_system.py, config.py]
autonomous: true

must_haves:
  truths:
    - "A persistent header displays the Round number and current turn"
    - "A persistent sidebar displays the Action List"
    - "The game map is correctly offset to make room for UI elements"
  artifacts:
    - path: "ecs/systems/ui_system.py"
      provides: "UI rendering and layout management"
---

<objective>
Build a persistent UI layout with a Header (Turn Info) and a Sidebar (Action List).

Purpose: Provide the player with critical game state information and a menu for actions.
Output: A structured UI overlay integrated into the rendering pipeline.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-core-gameplay-mechanics/03-01-SUMMARY.md
@.planning/phases/03-core-gameplay-mechanics/CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement UI Layout and Header</name>
  <files>ecs/systems/ui_system.py, ecs/systems/render_system.py, config.py</files>
  <action>
    - Define UI constants in `config.py` (HEADER_HEIGHT, SIDEBAR_WIDTH).
    - Create `ecs/systems/ui_system.py`:
        - Implement a system to render a UI Header at the top of the screen.
        - The Header should display the "Global Round" counter and the "Current Turn" status ("Player Turn" vs "Environment Turn").
    - Update `RenderSystem` to:
        - Draw the game map within a restricted area (viewport) to account for the Sidebar and Header.
        - Ensure UI is drawn on top or separately from the game world.
  </action>
  <verify>The screen shows a distinct Header area with round/turn text, and the map is not obscured by it.</verify>
  <done>UI layout and persistent Header are implemented.</done>
</task>

<task type="auto">
  <name>Task 2: Implement Action Sidebar</name>
  <files>ecs/systems/ui_system.py</files>
  <action>
    - Update `UISystem` to render a Sidebar on the right (or left as per design).
    - Implement an `ActionList` component or state to track available actions:
        - Move, Investigate, Ranged, Spells, Items.
    - Add logic to highlight the currently selected action and grey out unavailable ones (e.g., no arrows for ranged).
  </action>
  <verify>A Sidebar appears with a list of actions; the player can navigate the list (visually) using keys.</verify>
  <done>Action Sidebar is functional and integrated into the UI.</done>
</task>

</tasks>

<verification>
- [ ] Header shows Round and Turn.
- [ ] Sidebar shows Action List.
- [ ] UI does not overlap with map rendering inappropriately.
</verification>

<success_criteria>
The game has a persistent UI framework that displays game state and action options.
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-gameplay-mechanics/03-03-SUMMARY.md`
</output>