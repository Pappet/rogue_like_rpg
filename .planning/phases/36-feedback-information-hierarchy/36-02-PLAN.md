---
phase: 36-feedback-information-hierarchy
plan: 02
type: execute
wave: 2
depends_on: [36-01]
files_modified: [config.py, ui/message_log.py, ecs/systems/combat_system.py, services/consumable_service.py, game_states.py, ecs/systems/ui_system.py, ecs/systems/death_system.py]
autonomous: true
must_haves:
  truths:
    - "Message log entries are color-coded based on LogCategory"
    - "Log messages for damage dealt and received have distinct colors"
    - "Loot messages use a specific color (gold/yellow)"
    - "Low health alerts have distinct visual emphasis"
  artifacts:
    - path: "config.py"
      contains: "class LogCategory"
    - path: "ui/message_log.py"
      contains: "LogCategory"
---

<objective>
Enhance the message log with categorization and colors.
Purpose: Improve readability and emphasize important information for the player.
Output: LogCategory enum, categorized logging calls, and visual alerts.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/36-feedback-information-hierarchy/RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Log Category Infrastructure</name>
  <files>config.py, ui/message_log.py</files>
  <action>
    1. Define LogCategory enum in config.py:
       - Categories: DAMAGE_DEALT, DAMAGE_RECEIVED, HEALING, LOOT, SYSTEM, ALERT.
    2. Define LOG_COLORS dictionary in config.py mapping categories to RGB tuples.
       - e.g., DAMAGE_DEALT: (100, 255, 100), DAMAGE_RECEIVED: (255, 100, 100), LOOT: (255, 215, 0), HEALING: (50, 200, 255).
    3. Update MessageLog.add_message in ui/message_log.py:
       - Add optional 'category' parameter (defaulting to LogCategory.SYSTEM).
       - If category is provided, use the color from LOG_COLORS.
       - Ensure compatibility with existing [color=name] rich text tags.
  </action>
  <verify>LogCategory exists and MessageLog correctly maps categories to colors in the log.</verify>
  <done>Categorization infrastructure is ready for integration.</done>
</task>

<task type="auto">
  <name>Task 2: Implement Categorized Logging and Alerts</name>
  <files>ecs/systems/combat_system.py, ecs/systems/death_system.py, services/consumable_service.py, game_states.py, ecs/systems/ui_system.py</files>
  <action>
    1. Update CombatSystem in ecs/systems/combat_system.py:
       - Log damage dealt by player using LogCategory.DAMAGE_DEALT.
       - Log damage received by player using LogCategory.DAMAGE_RECEIVED.
    2. Update ConsumableService in services/consumable_service.py:
       - Log healing using LogCategory.HEALING.
    3. Update DeathSystem in ecs/systems/death_system.py and Game.pickup_item in game_states.py:
       - Log loot using LogCategory.LOOT.
    4. Implement Low Health alert in UISystem.process (ecs/systems/ui_system.py):
       - Check player HP percentage.
       - If HP < 25%, draw a subtle pulsing red vignette (alpha 0-80) on the viewport using the current world_clock time to calculate intensity.
       - Ensure the vignette is only drawn on the viewport area.
  </action>
  <verify>Log messages appear with correct colors. Red pulsing appears when health is low.</verify>
  <done>Player feedback is significantly improved with categorization and visual alerts.</done>
</task>

</tasks>

<success_criteria>
1. Log entries for damage are distinctly colored (e.g., Red for received, Cyan/Green for dealt).
2. Loot messages appear in Yellow/Gold.
3. Healing messages appear in Green/Blue.
4. Low health warning (visual red pulse) occurs at 25% health threshold.
</success_criteria>

<output>
After completion, create `.planning/phases/36-feedback-information-hierarchy/36-02-SUMMARY.md`
</output>
