---
phase: 25-equipment-slots-combat-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [ecs/components.py, entities/item_registry.py, entities/item_factory.py]
autonomous: true

must_haves:
  truths:
    - "New equipment components are available in the ECS world."
    - "Item factory can create equippable items from templates."
  artifacts:
    - path: "ecs/components.py"
      provides: "SlotType, Equippable, Equipment, EffectiveStats, StatModifiers"
    - path: "entities/item_registry.py"
      provides: "slot support in ItemTemplate"
    - path: "entities/item_factory.py"
      provides: "Equippable component attachment"
  key_links:
    - from: "entities/item_factory.py"
      to: "ecs/components.py"
      via: "importing Equippable"
---

<objective>
Define the data structures and components required for the equipment system and update the item creation pipeline to support equippable items.

Purpose: Establishing the foundation for slot-based equipment and dynamic stat modification.
Output: Updated components and item factory.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-equipment-slots-combat-integration/25-RESEARCH.md
@ecs/components.py
@entities/item_registry.py
@entities/item_factory.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define Equipment Components</name>
  <files>ecs/components.py</files>
  <action>
    Add/Verify the following in ecs/components.py:
    1. SlotType(str, Enum): HEAD, BODY, MAIN_HAND, OFF_HAND, FEET, ACCESSORY.
    2. Equippable component: slot (SlotType).
    3. Equipment component: slots (Dict[SlotType, Optional[int]]).
    4. EffectiveStats component: fields mirroring Stats (hp, max_hp, power, defense, mana, max_mana, perception, intelligence).
    5. StatModifiers component: (Verify existence) fields for hp, power, defense, mana, perception, intelligence.
    Note: StatModifiers.hp applies to both max_hp (the limit) and the effective current hp (the bonus).
  </action>
  <verify>Check ecs/components.py for new definitions.</verify>
  <done>All components/enums are defined correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Update Item Registry and Factory</name>
  <files>entities/item_registry.py, entities/item_factory.py</files>
  <action>
    1. Update ItemTemplate in entities/item_registry.py to include an optional 'slot' field (str).
    2. Update ItemFactory.create in entities/item_factory.py: if template.slot is present, add Equippable(SlotType(template.slot)) to the entity.
  </action>
  <verify>Run a small script to create an item with a slot and check if it has the Equippable component.</verify>
  <done>Item creation pipeline supports equipment slots.</done>
</task>

</tasks>

<verification>
Ensure components are importable and ItemFactory correctly handles the new 'slot' field.
</verification>

<success_criteria>
1. SlotType enum exists.
2. Equippable, Equipment, and EffectiveStats components exist.
3. ItemTemplate supports 'slot'.
4. ItemFactory attaches Equippable based on template.
</success_criteria>

<output>
After completion, create `.planning/phases/25-equipment-slots-combat-integration/25-01-SUMMARY.md`
</output>
