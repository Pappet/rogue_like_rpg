---
phase: 26-consumables-and-polish
plan: 02
type: execute
wave: 2
depends_on: [26-01]
files_modified: [game_states.py, ecs/systems/action_system.py]
autonomous: false

must_haves:
  truths:
    - "Player can use items from inventory by pressing 'U'"
    - "Using an item costs a turn"
    - "Inspection shows material and weight of items"
  artifacts:
    - path: "game_states.py"
      provides: "'Use' key handling"
    - path: "ecs/systems/action_system.py"
      provides: "Enhanced inspection descriptions"
---

<objective>
Integrate consumable usage into the Inventory UI and enhance item inspections with physical descriptions.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-consumables-and-polish/26-01-SUMMARY.md
@game_states.py
@ecs/systems/action_system.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add 'Use' Key to InventoryState</name>
  <files>game_states.py</files>
  <action>
    1. In `game_states.py`, update `InventoryState.get_event`:
       - Add handling for `pygame.K_u`.
       - When pressed, get the selected item ID.
       - Call `consumable_service.use_item(self.world, self.player_entity, selected_item_id)`.
       - If usage was successful, end the player's turn (`self.persist["turn_system"].end_player_turn()`) and exit inventory back to "GAME" state.
    2. Import `consumable_service` at the top of the file.
  </action>
  <verify>Launch game, pick up health potion, open inventory, press 'U' on it, and verify message log and HP increase.</verify>
  <done>Player can use items directly from the inventory UI.</done>
</task>

<task type="auto">
  <name>Task 2: Enhance Inspection with Material and Weight</name>
  <files>ecs/systems/action_system.py</files>
  <action>
    1. In `ecs/systems/action_system.py`, locate the inspection logic inside `confirm_action`.
    2. Modify the entity description loop to check for `ItemMaterial` and `Portable` components.
    3. Aggregate the findings: "Base description. Material: [material]. Weight: [weight]kg".
    4. Dispatch the aggregated string to the log.
  </action>
  <verify>Use 'Inspect' mode on an item on the ground and verify the log shows material and weight.</verify>
  <done>Inspection output provides richer physical detail about items.</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Consumable usage and enhanced inspection</what-built>
  <how-to-verify>
    1. Start the game.
    2. Find or spawn a health potion (e.g., in a starting room).
    3. Inspect the potion: ensure it says "Material: glass" and "Weight: 0.5kg".
    4. Pick up the potion.
    5. Damage the player (e.g., walk into a wall or let an enemy hit).
    6. Open inventory ('I'), select potion, press 'U'.
    7. Verify HP increase, message log entry, and that the turn advanced.
  </how-to-verify>
  <resume-signal>approved</resume-signal>
</task>

</tasks>

<verification>
Manual playtest of the full consumable loop (Pickup -> Inspect -> Use).
</verification>

<success_criteria>
- The 'U' key functions in the inventory for consumable items.
- Item usage correctly consumes a turn.
- Inspections provide comprehensive material and weight information.
</success_criteria>

<output>
After completion, create `.planning/phases/26-consumables-and-polish/26-02-SUMMARY.md`
</output>
