---
phase: 34-input-handling-control-scheme
plan: 03
type: execute
wave: 2
depends_on: ["34-01"]
files_modified: [ecs/components.py, entities/entity_factory.py, services/input_manager.py, ecs/systems/action_system.py, game_states.py]
autonomous: true

must_haves:
  truths:
    - "Pressing 1-9 keys triggers the corresponding action in the player's hotbar"
    - "Actions that require targeting enter Targeting state correctly"
  artifacts:
    - path: "ecs/components.py"
      contains: "class HotbarSlots"
  key_links:
    - from: "services/input_manager.py"
      to: "ecs/systems/action_system.py"
      via: "hotbar command execution"
---

<objective>
Implement hotbar action selection using numeric keys (1-9). This allows the player to quickly use abilities or items without navigating the action list.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-input-handling-control-scheme/34-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Add Hotbar Component and Infrastructure</name>
  <files>ecs/components.py, entities/entity_factory.py</files>
  <action>
    - Add HotbarSlots component to ecs/components.py (maps indices 0-8 to action objects or indices).
    - Update entity_factory.py to add HotbarSlots to the player entity.
    - Initialize the hotbar with some default actions (e.g., Slot 1 = Move, Slot 2 = Wait, etc. as placeholders or real actions if available).
  </action>
  <verify>
    Verify that player entity has HotbarSlots component after creation.
  </verify>
  <done>
    Hotbar infrastructure is present on the player entity.
  </done>
</task>

<task type="auto">
  <name>Implement Hotbar Input and Execution</name>
  <files>services/input_manager.py, ecs/systems/action_system.py, game_states.py</files>
  <action>
    - Update InputManager in services/input_manager.py to handle numeric keys 1-9 and map them to HOTBAR_1 through HOTBAR_9 commands.
    - Update Game.handle_player_input in game_states.py to handle HOTBAR_* commands.
    - When a hotbar command is received, look up the action in the player's HotbarSlots component.
    - Use ActionSystem to execute the found action (either perform_action or start_targeting depending on the action).
  </action>
  <verify>
    Run the game and verify that pressing '1' or '2' triggers the actions assigned to those slots.
  </verify>
  <done>
    Numeric keys correctly trigger hotbar actions.
  </done>
</task>

</tasks>

<verification>
python tests/verify_action_wiring.py
Run game: Press 1, 2, 3 to trigger actions.
</verification>

<success_criteria>
1. Action hotbar allows immediate selection/execution via numeric keys.
2. Hotbar mapping is respected when keys are pressed.
</success_criteria>

<output>
After completion, create .planning/phases/34-input-handling-control-scheme/34-03-SUMMARY.md
</output>
