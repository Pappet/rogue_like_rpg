---
phase: 04-combat-feedback
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - ecs/components.py
  - entities/monster.py
  - services/map_service.py
  - services/party_service.py
  - config.py
autonomous: true
must_haves:
  truths:
    - "Orc monsters appear on the map"
    - "Monsters have Stats components (HP, Power, Defense)"
    - "Monsters block movement"
    - "Player is initialized with power and defense stats"
  artifacts:
    - path: "ecs/components.py"
      contains: "class Stats"
    - path: "entities/monster.py"
      provides: "create_orc function"
  key_links:
    - from: "MapService.create_sample_map"
      to: "create_orc"
      via: "Spawning loop"
---

<objective>
Implement Monster Entities (Orcs) and Player Stats initialization.
Purpose: Provide enemies for the player to interact with and establish combat stats for all entities.
Output: Orcs spawned in the game world, Player stats updated.
</objective>

<context>
@ecs/components.py
@services/map_service.py
@services/party_service.py
@config.py
</context>

<tasks>

<task type="auto">
  <name>Refactor Stats component and Create Monster Factory</name>
  <files>ecs/components.py, entities/monster.py</files>
  <action>
    1.  **Refactor Stats component to include power and defense fields:**
        -   Modify `ecs/components.py`: Update `Stats` component to include `power: int` and `defense: int`.
    2.  Create `entities/monster.py`:
        -   Function `create_orc(world, x, y)`:
            -   Creates entity.
            -   Adds `Position`, `Renderable` (sprite="O", color=Green, layer=ENTITIES), `Blocker`.
            -   Adds `Stats` (HP=10, max_hp=10, power=3, defense=0, mana=0, max_mana=0, perception=5, intelligence=5).
            -   Adds `Name("Orc")`.
            -   Adds `AI` (basic placeholder).
  </action>
  <verify>Check `Stats` component has `power` and `defense`. Check `create_orc` function uses `Stats`.</verify>
  <done>Stats component refactored and monster factory implemented.</done>
</task>

<task type="auto">
  <name>Update PartyService for Player Stats</name>
  <files>services/party_service.py</files>
  <action>
    1.  Update `PartyService.create_initial_party`:
        -   Initialize Player `Stats` with `power=5` and `defense=2` (example values).
  </action>
  <verify>Check `services/party_service.py` for updated `Stats` initialization.</verify>
  <done>Player initialized with power and defense.</done>
</task>

<task type="auto">
  <name>Spawn Monsters in Map Service</name>
  <files>services/map_service.py</files>
  <action>
    1.  Import `create_orc`.
    2.  In `create_sample_map` (or new `spawn_entities` method):
        -   Iterate through rooms (if rooms exist) or pick random walkable locations.
        -   Spawn 2-3 Orcs for testing.
        -   Ensure they don't spawn on top of player.
  </action>
  <verify>Run game. See "O" sprites on map.</verify>
  <done>Monsters appear in world.</done>
</task>

</tasks>

<verification>
- [ ] Orcs visible on map.
- [ ] Orcs block player movement (due to Blocker component).
- [ ] Player and monsters have power/defense stats.
</verification>

<success_criteria>
- Orcs exist with stats.
- Player has combat stats.
</success_criteria>

<output>
After completion, create `.planning/phases/04-combat-feedback/04-02-SUMMARY.md`
</output>