---
phase: 02-core-gameplay-loop
plan: 4
type: execute
wave: 4
depends_on:
  - "02-03"
files_modified:
  - services/turn_service.py
  - main.py
  - game_states.py
autonomous: true
must_haves:
  truths:
    - "The game waits for player input to proceed."
    - "An action from the player constitutes a turn."
  artifacts:
    - path: "services/turn_service.py"
      provides: "A service to manage game turns."
    - path: "main.py"
      provides: "The main game loop, updated to use the turn-based system."
    - path: "game_states.py"
      provides: "Game state constants, updated to include player turn."
  key_links:
    - from: "main.py"
      to: "services/turn_service.py"
      via: "Uses the turn service to manage the game state."
    - from: "services/turn_service.py"
      to: "game_states.py"
      via: "Transitions the game between states."
---

<objective>
This plan introduces a fundamental turn-based system, which is a core mechanic of the game. It will control the flow of the game, alternating between player and enemy turns.

Purpose: To establish the turn-based structure that will govern gameplay.
Output: A game that progresses in turns, starting with the player's turn.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-gameplay-loop/CONTEXT.md
@.planning/phases/02-core-gameplay-loop/02-01-SUMMARY.md
@.planning/phases/02-core-gameplay-loop/02-02-SUMMARY.md
@.planning/phases/02-core-gameplay-loop/02-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Game States</name>
  <files>game_states.py</files>
  <action>
    Update the `GameStates` enum in `game_states.py` to include a `PLAYER_TURN` state.
  </action>
  <verify>
    The `game_states.py` file contains the updated `GameStates` enum.
  </verify>
  <done>
    The game states now account for the player's turn.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TurnService</name>
  <files>services/turn_service.py</files>
  <action>
    Create a `TurnService` class in `services/turn_service.py`.
    This service will manage the current game state.
    Implement a method to get the current turn holder (e.g., player or an enemy).
    For now, it will always be the player's turn.
  </action>
  <verify>
    The file `services/turn_service.py` exists and contains the `TurnService` class.
  </verify>
  <done>
    The `TurnService` is in place to manage turns.
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate Turn-Based Logic</name>
  <files>main.py</files>
  <action>
    Update `main.py` to use the `TurnService`.
    - Instantiate the `TurnService`.
    - Set the initial game state to `PLAYER_TURN`.
    - In the game loop, only process player input when the game state is `PLAYER_TURN`.
    - After the player performs an action (e.g., moves), the turn should end, but for now, it will remain the player's turn.
  </action>
  <verify>
    Player actions are only processed when it is the player's turn.
  </verify>
  <done>
    The game now has a basic turn-based loop.
  </done>
</task>

</tasks>

<verification>
- The game starts in the `PLAYER_TURN` state.
- The player can perform actions only during their turn.
</verification>

<success_criteria>
- The core turn-based mechanic is implemented, providing a foundation for adding more complex gameplay elements like enemy AI.
</output>
