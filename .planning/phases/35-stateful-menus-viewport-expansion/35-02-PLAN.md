---
phase: 35-stateful-menus-viewport-expansion
plan: 02
type: execute
wave: 2
depends_on: ["35-01"]
files_modified: [ui/windows/inventory.py, ui/windows/character.py, game_states.py, services/input_manager.py]
autonomous: true

must_haves:
  truths:
    - "Pressing 'I' opens the inventory modal"
    - "Pressing 'C' opens the character modal"
    - "Modals can be closed with ESC"
  artifacts:
    - path: "ui/windows/inventory.py"
      provides: "InventoryWindow class"
    - path: "ui/windows/character.py"
      provides: "CharacterWindow class"
---

<objective>
Replace the existing InventoryState with a modal window and implement a new Character Sheet modal.

Purpose: Provide modal access to items and player information without breaking game state.
Output: Functional Inventory and Character windows pushed to UIStack.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-stateful-menus-viewport-expansion/35-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement InventoryWindow modal</name>
  <files>ui/windows/inventory.py</files>
  <action>
    Migrate rendering and event logic from `InventoryState` in `game_states.py` to a new `InventoryWindow(UIWindow)` class.
    Ensure it uses a centered surface and supports item actions (Equip, Drop, Use).
    Update `InventoryWindow` to close itself (pop from stack) when 'ESC' or 'I' is pressed.
  </action>
  <verify>Push InventoryWindow to stack and verify all functions (use/drop/equip) still work.</verify>
  <done>Inventory modal is fully functional and replaces the old state.</done>
</task>

<task type="auto">
  <name>Task 2: Implement CharacterWindow modal</name>
  <files>ui/windows/character.py</files>
  <action>
    Create a `CharacterWindow(UIWindow)` class that displays:
    - Basic stats (Str, Dex, Int, etc.)
    - Calculated stats (Power, Defense, Speed)
    - Equipped items in their respective slots.
    - Reputation or other character-level data if available.
    Use a layout similar to Inventory but focused on stats.
  </action>
  <verify>Push CharacterWindow to stack and verify information is accurate to current ECS components.</verify>
  <done>Character sheet modal provides a comprehensive overview of the player.</done>
</task>

<task type="auto">
  <name>Task 3: Wire hotkeys and remove old InventoryState</name>
  <files>game_states.py, services/input_manager.py</files>
  <action>
    1. Update `InputCommand` and `InputManager` to include `OPEN_CHARACTER` (mapped to 'C').
    2. In `Game.handle_player_input`, change `OPEN_INVENTORY` to push `InventoryWindow` to `ui_stack`.
    3. Add handling for `OPEN_CHARACTER` to push `CharacterWindow`.
    4. Remove `InventoryState` class and its registration in `GameController` (main.py).
  </action>
  <verify>Test 'I' and 'C' keys in-game; ensure they open the respective modals and 'ESC' closes them.</verify>
  <done>Input wiring is complete and legacy code is removed.</done>
</task>

</tasks>

<verification>
Open inventory, equip an item, open character sheet, verify item shows up there. Close both and ensure game resumes correctly.
</verification>

<success_criteria>
1. Inventory and Character sheets are modals, not full states.
2. Full feature parity with old InventoryState.
3. ESC correctly pops the top-most window.
</success_criteria>

<output>
After completion, create `.planning/phases/35-stateful-menus-viewport-expansion/35-02-SUMMARY.md`
</output>
