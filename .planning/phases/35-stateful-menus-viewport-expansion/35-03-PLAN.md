---
phase: 35-stateful-menus-viewport-expansion
plan: 03
type: execute
wave: 3
depends_on: ["35-02"]
files_modified: [config.py, main.py, components/camera.py, ecs/systems/ui_system.py, ecs/systems/render_system.py]
autonomous: true

must_haves:
  truths:
    - "Sidebar is no longer present on screen"
    - "Game map fills the horizontal space previously taken by the sidebar"
    - "HP/Mana and Rounds are still visible"
  artifacts:
    - path: "ecs/systems/ui_system.py"
      provides: "Refactored HUD rendering"
---

<objective>
Expand the game viewport to use the full screen width and move essential sidebar information to a persistent HUD.

Purpose: Increase immersion and world visibility.
Output: A cleaner UI with a larger game viewport.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-stateful-menus-viewport-expansion/35-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Reclaim sidebar space in configuration and viewport</name>
  <files>config.py, main.py, components/camera.py</files>
  <action>
    1. Set `SIDEBAR_WIDTH = 0` in `config.py`.
    2. Ensure `GameController` and `Camera` use `SIDEBAR_WIDTH` for viewport calculations (they should now automatically expand).
    3. Update `Camera` to handle the full width of the screen (minus potential padding).
  </action>
  <verify>Run the game and verify the map rendering now extends to the right edge of the screen.</verify>
  <done>Viewport is physically expanded to full width.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor UISystem to compact HUD</name>
  <files>ecs/systems/ui_system.py</files>
  <action>
    1. Remove `draw_sidebar` calls.
    2. Move high-priority sidebar info (Equipment, Stats) to the modal CharacterWindow (already done in 35-02).
    3. Ensure the Header remains at the top with HP/Mana and Clock.
    4. Reposition the Message Log if needed (it currently occupies full width minus SIDEBAR_WIDTH, which is now full width).
    5. Add a small 'Hotbar' display to the bottom or header if the current sidebar Action list is still desired for quick reference. (Note: Hotbar selection 1-9 was added in Phase 34).
  </action>
  <verify>Verify all essential info is still accessible via the Header or the new Modals.</verify>
  <done>UI is cleaned up and optimized for the new viewport dimensions.</done>
</task>

<task type="auto">
  <name>Task 3: Final viewport and rendering polish</name>
  <files>ecs/systems/render_system.py, services/render_service.py</files>
  <action>
    Check for any hardcoded `SIDEBAR_WIDTH` references in rendering logic or clipping rects.
    Ensure `RenderSystem` and `DebugRenderSystem` correctly use the expanded viewport.
    Verify tinting and FOV effects still cover the new area.
  </action>
  <verify>Perform a full test run, moving between maps and checking all debug overlays.</verify>
  <done>Rendering is robust across the expanded viewport.</done>
</task>

</tasks>

<verification>
Confirm the map is significantly larger. Verify that HP/Mana and Log are still functional. Check that modals are still centered correctly on the new width.
</verification>

<success_criteria>
1. Sidebar is gone.
2. Game viewport is ~220px wider.
3. All critical game info remains visible or accessible via modals.
</success_criteria>

<output>
After completion, create `.planning/phases/35-stateful-menus-viewport-expansion/35-03-SUMMARY.md`
</output>
