---
phase: 27-world-clock-foundation
plan: 03
type: execute
wave: 3
depends_on: [27-02]
files_modified: [tests/verify_world_clock.py]
autonomous: true

must_haves:
  truths:
    - "Automated tests confirm clock math"
    - "Automated tests confirm turn integration"
    - "Automated tests confirm map transition sync"
  artifacts:
    - path: "tests/verify_world_clock.py"
      provides: "Automated regression tests"
---

<objective>
Verify the integrity of the WorldClock system through automated tests and final visual checks.

Purpose: Ensures time logic is robust before building day/night effects and schedules on top of it.
Output: Verification test suite.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-world-clock-foundation/27-01-SUMMARY.md
@.planning/phases/27-world-clock-foundation/27-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create verification test for WorldClock</name>
  <files>tests/verify_world_clock.py</files>
  <action>
    Create a test script `tests/verify_world_clock.py` that:
    1. Instantiates `WorldClockService` and tests `advance` across hour and day boundaries.
    2. Verifies phase transitions at defined boundaries (5, 7, 18, 20).
    3. Mocks a `TurnSystem` and verifies `end_player_turn` advances the linked clock.
    4. Mocks a map transition and verifies `round_counter` sync with `total_ticks`.
  </action>
  <verify>Run `python tests/verify_world_clock.py` and ensure all assertions pass.</verify>
  <done>Core timekeeping and integration logic is verified via code.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full WorldClock foundation (logic + integration + UI)</what-built>
  <how-to-verify>
    1. Run `python main.py`.
    2. Take several steps and verify "Round" and "Time" advance in the header.
    3. Take 60 steps and verify the "Hour" increments.
    4. Verify the TOD phase (e.g., DAY, DUSK) updates when passing a boundary.
    5. Check if the time persists when opening/closing the Inventory (i).
  </how-to-verify>
  <resume-signal>approved</resume-signal>
</task>

</tasks>

<verification>
Run all automated tests and perform manual UI check.
</verification>

<success_criteria>
- All automated tests pass.
- Time advancement is visually confirmed in-game.
- Time persistence is confirmed.
</success_criteria>

<output>
After completion, create `.planning/phases/27-world-clock-foundation/27-03-SUMMARY.md`
</output>
