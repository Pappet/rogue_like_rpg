---
phase: 33-ui-rendering-modularization
plan: 03
type: execute
wave: 3
depends_on: ["33-02"]
files_modified: [ecs/systems/ui_system.py, tests/verify_ui_modularization.py]
autonomous: true

must_haves:
  truths:
    - "A new 'Needs' section exists in the sidebar (implemented with single call)"
    - "No hardcoded numbers (magic literals) exist in ui_system.py's rendering methods"
    - "UI elements align properly across all headers and sidebar sections"
  artifacts:
    - path: "ecs/systems/ui_system.py"
      provides: "New Needs sidebar section"
    - path: "tests/verify_ui_modularization.py"
      provides: "Automated check for hardcoded literals"
  key_links:
    - from: "draw_sidebar"
      to: "_draw_sidebar_needs"
      via: "method call"
---

<objective>
Verify that the modularized UI meets the success criteria and add a new "Needs" section to prove extensibility.

Purpose: Ensure no regressions and demonstrate how easily new sections can be added to the dynamic layout.
Output: Validated UI system and a new "Needs" section (stubbed for now).
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@ecs/systems/ui_system.py
@.planning/phases/33-ui-rendering-modularization/33-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement the "Needs" Sidebar Section</name>
  <files>ecs/systems/ui_system.py</files>
  <action>
    - Add a new modular method `_draw_sidebar_needs(surface, cursor)`.
    - It should display "Hunger: 0%" and "Fatigue: 0%" using `UI_LINE_SPACING`.
    - Call this function in `draw_sidebar` after the Combat Stats section.
    - Confirm it takes only a single line in `draw_sidebar` to integrate.
  </action>
  <verify>
    Run main.py and check for the new "Needs" section at the bottom of the sidebar.
  </verify>
  <done>
    New section is integrated with a single function call.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Automated Verification Script for Magic Numbers</name>
  <files>tests/verify_ui_modularization.py</files>
  <action>
    Create a script that:
    - Reads ecs/systems/ui_system.py.
    - Greps/Regexes for numeric literals used in `draw_header`, `draw_sidebar`, and all modular section functions.
    - Fails if it finds unexplained numbers (excluding 0, 1, 2, or known constants).
    - Checks for the presence of `LayoutCursor` usage.
  </action>
  <verify>
    Run `python tests/verify_ui_modularization.py`.
  </verify>
  <done>
    Script confirms zero magic numbers in the rendering logic.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Refactored, modularized UI system with dynamic layout.</ what-built>
  <how-to-verify>
    1. Launch the game: `python main.py`.
    2. Check the header: Verify "Round", "Day - HH:MM (PHASE)", "Turn Info", and "HP/MP" are present and aligned.
    3. Check the sidebar: Verify "Resource Bars", "Actions", "Equipment", "Combat Stats", and the new "Needs" section are present and properly spaced.
    4. Confirm that resizing the header_height or sidebar_width in config.py (temporarily) doesn't break element alignment.
  </how-to-verify>
  <resume-signal>approved</resume-signal>
</task>

</tasks>

<verification>
Run the magic number verification script.
Perform manual visual inspection.
</verification>

<success_criteria>
1. ui_system.py contains zero hardcoded positioning literals (magic numbers).
2. UI elements are positioned relative to container boundaries using constants.
3. Sidebar elements stack vertically using a shared Y-cursor logic.
4. Adding a new UI section (e.g., "Needs") required only a single function call.
</success_criteria>

<output>
After completion, create `.planning/phases/33-ui-rendering-modularization/33-03-SUMMARY.md`
</output>
