---
phase: 33-ui-rendering-modularization
plan: 02
type: execute
wave: 2
depends_on: ["33-01"]
files_modified: [ecs/systems/ui_system.py]
autonomous: true

must_haves:
  truths:
    - "Sidebar sections (Actions, Equipment, Stats) are drawn using modular functions"
    - "All positioning in sidebar is dynamic via LayoutCursor"
    - "Header elements use relative positioning to its boundaries"
  artifacts:
    - path: "ecs/systems/ui_system.py"
      provides: "Modular rendering methods for UI sections"
  key_links:
    - from: "draw_sidebar"
      to: "_draw_sidebar_actions"
      via: "method call"
    - from: "draw_sidebar"
      to: "_draw_sidebar_equipment"
      via: "method call"
---

<objective>
Refactor `draw_sidebar` and `draw_header` into modular, reusable section rendering functions.

Purpose: Eliminate the monolithic structure and make the UI easily extensible by wrapping sections in dedicated methods that manage their own spacing.
Output: Decoupled rendering methods in `ui_system.py` that use the `LayoutCursor`.
</objective>

<execution_context>
@/home/peter/.gemini/get-shit-done/workflows/execute-plan.md
@/home/peter/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@ecs/systems/ui_system.py
@.planning/phases/33-ui-rendering-modularization/33-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract Sidebar Sections into Modular Functions</name>
  <files>ecs/systems/ui_system.py</files>
  <action>
    - Extract `draw_stats_bars` logic into `_draw_sidebar_resource_bars(surface, cursor)`.
    - Extract "Actions" section into `_draw_sidebar_actions(surface, cursor)`.
    - Extract "Equipment" section into `_draw_sidebar_equipment(surface, cursor)`.
    - Extract "Combat Stats" section into `_draw_sidebar_combat_stats(surface, cursor)`.
    - All functions must take a `LayoutCursor` and update its Y-position via `cursor.advance()`.
    - Use `UI_SECTION_SPACING` between sections and `UI_LINE_SPACING` within sections.
    - Create a helper `_draw_section_title(surface, cursor, title)` for consistent headers.
  </action>
  <verify>
    Verify sidebar sections are called in sequence and look correct in game.
  </verify>
  <done>
    Sidebar rendering is fully modularized.
  </done>
</task>

<task type="auto">
  <name>Task 2: Refactor draw_header for Relative Positioning</name>
  <files>ecs/systems/ui_system.py</files>
  <action>
    - Refactor `draw_header` to use constants for all positioning.
    - Round/Time info: position at `self.header_rect.x + UI_PADDING`.
    - Stats info (HP/MP): position at `self.header_rect.right - stats_surf.get_width() - UI_PADDING`.
    - Turn info: center in `self.header_rect`.
    - Remove all magic number offsets.
  </action>
  <verify>
    Ensure header elements are properly aligned and look identical to original.
  </verify>
  <done>
    Header rendering uses relative positioning and no magic numbers.
  </done>
</task>

</tasks>

<verification>
Check that draw_sidebar is now a sequence of modular function calls.
Check that draw_header uses header_rect boundaries and UI_PADDING.
</verification>

<success_criteria>
1. draw_sidebar contains no detailed rendering logic (delegates to sections).
2. All sections correctly increment the LayoutCursor.
3. No hardcoded coordinates (e.g., 20, 150, 10) in draw_header/sidebar methods.
</success_criteria>

<output>
After completion, create `.planning/phases/33-ui-rendering-modularization/33-02-SUMMARY.md`
</output>
