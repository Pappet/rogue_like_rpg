# Phase tech-debt Plan 01: v1.6 Tech Debt Fix Summary

## One-liner
Centralized UI color and spacing constants in `config.py` and fixed input leakage in modal windows.

## Frontmatter
- **Phase:** tech-debt
- **Plan:** 01
- **Subsystem:** UI
- **Tags:** tech-debt, refactoring, input-fix
- **Dependency Graph:** Affects all UI windows and message log.
- **Tech Stack:** Pygame, ECS
- **Key Files:** 
    - `config.py` (added constants)
    - `ui/message_log.py` (refactored)
    - `ui/windows/inventory.py` (refactored + input fix)
    - `ui/windows/character.py` (refactored + input fix)
- **Decisions:** 
    - Consuming all `KEYDOWN` events in modal windows is necessary to prevent background game state changes.
- **Metrics:**
    - Duration: ~20m
    - Completed Date: 2026-02-21

## Description
This plan addressed technical debt identified during the v1.6 audit. The primary focus was on centralizing magic numbers (specifically colors) into `config.py` and fixing a critical UX issue where keyboard input would "leak" through open modal windows to the game world.

### Key Changes
1.  **Centralized Constants:**
    - Defined a suite of generic colors (`COLOR_WHITE`, `COLOR_RED`, etc.) in `config.py`.
    - Defined UI-specific color constants (`UI_COLOR_WINDOW_BG`, `UI_COLOR_LOG_BG`, etc.).
    - Refactored `MessageLog`, `InventoryWindow`, and `CharacterWindow` to use these centralized constants.
2.  **Input Leakage Fix:**
    - Modified `handle_event` in `InventoryWindow` and `CharacterWindow` to return `True` for all `KEYDOWN` events.
    - This ensures that while a modal is open, movement or other game actions cannot be triggered in the background.
3.  **Spacing Refactor:**
    - Replaced several magic numbers for UI spacing with existing constants like `UI_SPACING_X` and `UI_SECTION_SPACING`.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed input leak in InventoryWindow**
- **Found during:** Verification of CharacterWindow fix.
- **Issue:** InventoryWindow also returned `False` for unmapped keys, allowing them to leak.
- **Fix:** Added `return True` for all `KEYDOWN` events in `InventoryWindow.handle_event`.
- **Files modified:** `ui/windows/inventory.py`
- **Commit:** `b891acb`

## Self-Check: PASSED
- [x] All tasks executed.
- [x] Each task committed individually.
- [x] All deviations documented.
- [x] SUMMARY.md created.
- [x] STATE.md updated.
